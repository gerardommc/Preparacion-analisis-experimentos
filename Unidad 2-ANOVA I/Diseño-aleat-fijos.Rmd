---
title: "Diseño completamente aleatorizado con efectos fijos"
author: "Gerardo Martín"
date: "15/2/2021"
output: 
      bookdown::html_document2:
            toc: true 
            number_sections: true
            toc_float: true
            theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introducción

En la [clase anterior](ANOVA-I.html), vimos cómo se hace un análisis de varianza con **efectos fijos**. Éstos se refieren al efecto estadístico que tienen los factores que estamos controlando, aquellos que conocemos y nos interesa entender. Como vimos en la sección de [Bloques y balance](../Unidad 1-Introducción/Bloques-balance.html) de la unidad anterior, en ocasiones es necesario utilizar bloques experimentales para poder contar con réplicas verdaderas. Debido a que los bloques pueden intrioucir efectos adicionales a aquellos que estamos midiendo, como los tratamientos, los bloques, dentro del análisis estadístico se consideran como efectos aleatorios. Esto quiere decir que se va a sumir que los bloques van a aumentar la variabilidad (varianza, $\sigma^2$) de la variable de respuesta que estamos midiendo, mientras que los efectos fijos sólo van a afectar el valor de la media (promedio). Los diseños ANOVA de una vía pueden contener tanto efectos fijos como aleatorios.

## Diseño aleatorizado

### Efectos fijos

Este diseño consiste de la asignación de las unidades experimentales a los diferentes tratamientos de manera completamente aleatoria. Por ejemplo, si vamos a comparar el efecto de dos fertilizantes contra un grupo control, el criterio para dividir las plantas entre tratamientos debe ser completamente aleatorio.

Existen muchas maneras de asignar aleatoriamente las unidades experimentales a los tratamientos, pero una manera sencilla y confiable de hacer esto sería con un programa de computadora. Por ejemplo, si tenemos 15 plantas con características más o menos parecidas y las enumeramos del 1-15, podríamos asignarlas a los tratamientos con un programa que revuelve la secuencia $1, \dots, 15$, de modo que los primeros cinco números serán asignados al tratamiento A:

```{r echo=F, results='markup'}
source("Random-functions/Shuffle.R")
planta <- shuffle(15)
planta[1:5]
```

del 6-10 al tratamiento B:

```{r echo=F, results='markup'}
planta[6:10]
```

y del 11-15 al control:

```{r echo=F, results='markup'}
planta[11:15]
```

Y posteriormente, también acomodamos las plantas aleatoriamente dentro de la instalación donde se hará el experimento. Este diseño experimental sin bloques se vería así:

```{r Fijos, echo=F, fig.height=3.5, fig.width=5.5, message=FALSE, fig.align='center', fig.cap="Diseño experimental completamente aleatorizado con efectos fijos. Los números dentro de cada punto representan las plantas etiquetadas aleatoriamente con el programa de computadora."}
library(ggplot2)

tratamiento <- rep(c("A", "B", "Contr"), each = 5)
trat <- data.frame(planta = planta, Tratamiento = tratamiento)
trat <- trat[shuffle(15), ]
rownames(trat) <- 1:15

x <- 1:5
y = 1:3

xy <- expand.grid(x = x, y = y)
xy <- cbind(xy, trat)

ggplot(xy) + geom_point(aes(x = x, y = y, colour = Tratamiento), size = 8) + 
      geom_text(aes(x = x, y = y, label = planta)) +
      theme(axis.text = element_blank(),
            axis.ticks = element_blank(),
            axis.title = element_blank())
```
En el análisis estadístico de este diseño experimental sólo tendremos efectos fijos, que sería el tratamiento con tres niveles, A, B, y Control. Recordemos que los controles son unidades experimentales que no están sujetas a ningún tratamiento. Todos los ejercicios de ANOVA que hicimos anteriormente fueron de diseños experimentales como este, completamente aleatorizados con efectos fijos únicamente. Un diseño experimental con efectos aleatorios sería el siguiente:

```{r Aleatorios, echo = F, fig.height=3, fig.width=8, fig.cap="Diseño aleatorizado con bloques (efectos aleatorios)."}

planta.2 <- shuffle(15)

trat.2 <- data.frame(planta = planta.2, Tratamiento = tratamiento)
trat.2 <- trat.2[shuffle(15), ]
rownames(trat.2) <- 1:15

x <- 1:5
y = 1:3

xy.2 <- expand.grid(x = x, y = y)
xy.2 <- cbind(xy.2, trat.2)

xy$Bloque <- "Bloque 1"
xy.2$Bloque <- "Bloque 2"

xy.3 <- rbind(xy, xy.2)

ggplot(xy.3) + geom_point(aes(x = x, y = y, colour = Tratamiento), size = 8) + 
      geom_text(aes(x = x, y = y, label = planta)) +
      facet_grid(~Bloque) +
      theme(axis.text = element_blank(),
            axis.ticks = element_blank(),
            axis.title = element_blank())
```
# Discusión y conclusiones

Los dos diseños experimentales mostrados aquí son muy similares, pues la única diferencia entre ellos es que el primero (figura \@ref(fig:Fijos)), sólo consta de un bloque, por lo que sólo hay efectos fijos (tratamientos); y en el segundo hay dos bloques por lo que hay efectos fijos y aleatorios (bloques).

Los **efectos fijos** son aquellos que conocemos y sabemos que afectan el valor medio de la respuesta. Los **efectos aleatorios** son aquellos que no estamos midiendo y que afectarán la variabilidad (varianza) de la variable de respuesta.

# Aplicación del conocimiento

Esta sesión práctica constará de dos partes:

1. Tutorial de R
2. ANOVA de una vía con efectos fijos
3. Interpretación de los resultados

## Tutorial de R

Para hacer un ANOVA en R hay una serie de pasos que seguir. El primero es preparar el entorno de cómputo que consta de [instalar **R**](https://cran.itam.mx/) y un entorno de desarrollo como [**R studio**](https://rstudio.com/products/rstudio/download/#download). Ambos paquetes son multiplataforma (Windows, Mac o Linux). Alternativamente, pueden dirigirse a [**R studio cloud**](https://login.rstudio.cloud/login?redirect=%2Foauth%2Fauthorize%3Fredirect_uri%3Dhttps%253A%252F%252Frstudio.cloud%252Flogin%26client_id%3Drstudio-cloud%26response_type%3Dcode%26show_auth%3D0%26show_login%3D1%26show_setup%3D1&setup=True) y acceder a la versión en línea con su cuenta institucional. Si no tienen acceso a computadora e internet en casa recomiendo la segunda opción, pues ahí pueden almacenar sus proyectos y tareas para acceder desde cualquier lugar.

Una vez que tienen **R** y **R** studio instalados, o están en **R** studio cloud, podemos proceder a crear un script nuevo, dando click en la hoja con un gino +, bajo el menú de *Archivo* o *File*, y seleccionamos la primera opción. En este archivo podemos ir escribiendo el código y guardar el archivo de texto. Cada línea que escribimos aquí debe ser mandada a la **consola**, que es donde **R** va a evaluar el código que esbribimos. Para correr el código escrito debemos colocar el cursor y presionar el botón **Run**.

Existen varios tipos de objetos por default que **R** puede manejar, y que almacenan distintos tipos de datos. Por ejemplo con la función `c` creamos cadenas de números que guardamos en `x` usando el operador `<-`:

```{r}
x <- c(1, 2, 3, 4, 5)
```

Y después podemos ver que `x` contiene esos valores:
```{r}
x
```

También podemos crear objetos que almacenan cadenas de texto:

```{r}
a <- c("a", "b", "c", "d", "e")
a
```

Las cadenas de texto **siempre** deben in dentro de `""`, de otro modo **R** tratará de leer los objetos con nombre `x` ó `a`. Una vez que aprendimos a crear objetos de esta naturaleza podemos arreglarlos en una tabla, utilizando una función llamada `data.frame`:

```{r}
tabla <- data.frame(a = a, x = x)
tabla
```

Podemos ver que `tabla` contiene dos columnas, una llamada `a` que contiene las letras y otra llamada `x` que contiene los números. Para acceder a las diferentes columnas de `tabla` utilizamos el operados `$` así:

```{r}
tabla$x
tabla$a
```

Los objetos creados con la función `data.frame` son el formato más común para manejar datos dentro de **R** para hacer análisis estadísticos, y es lo único que necesitamos hasta ahora para hacer un ANOVA.

## ANOVA de una vía con efectos fijos en R



[Regresar al índice del curso](../index.html)